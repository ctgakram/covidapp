@using AppProj.Web.Helpers;
@using AppProj.Web;
@model AppProj.Web.Models.SearchModel
@{
    Layout = "~/Views/Shared/_LayoutGeneral.cshtml";
    var ajaxOpt = new AjaxOptions
    {
        HttpMethod = "POST",
        UpdateTargetId = "dialog1Body",
        InsertionMode = InsertionMode.Replace,
        OnSuccess = "openDialog1('Followup')",
        LoadingElementId = "loading",
        OnFailure = "failure"
    };
}

<section id="formElement" class="utopia-widget utopia-form-box section">
    <div class="utopia-widget-title">
        <img src="~/Content/img/icons2/burn_blu-ray2.png" class="utopia-widget-icon utopia-icons2-small-img">
        <span class="textPrimary">All Profiles</span>

        <span class="textPrimary" id="iTotalRecords" style="float:right; padding-right:10px;">0</span>
        <span class="textPrimary" style="float:right;">Total Records: </span>
    </div>

    <div class="row-fluid">
        <div class="utopia-widget-content">
            <div class="span2 utopia-form-freeSpace">
                <fieldset>
                    <div class="control-group ">
                        <label class="control-label" for="ContentTypeId1"> Program:</label>
                        <div class="controls">
                            @Html.DropDownListFor(model => model.ContentTypeId1, Model.ContentTypes1, "All Programs", new { @class = "span12 ddl" })

                        </div>
                    </div>
                </fieldset>


            </div>
            <div class="span2 utopia-form-freeSpace">
                <fieldset>
                    <div class="control-group ">
                        <label class="control-label" for="ContentTypeId2">Division:</label>
                        @Html.DropDownListFor(model => model.ContentTypeId2, Model.ContentTypes2, "All Divisions", new { @class = "span12 ddl" })

                    </div>
                </fieldset>
            </div>
            <div class="span2 utopia-form-freeSpace">
                <fieldset>
                    <div class="control-group ">
                        <label class="control-label" for="ContentTypeId3"> District :</label>
                        <div class="controls">
                            @Html.DropDownListFor(model => model.ContentTypeId3, Model.ContentTypes3, "All Districts", new { @class = "span12 ddl" })

                        </div>
                    </div>
                </fieldset>
            </div>
            <div class="span2 utopia-form-freeSpace">
                <fieldset>
                    <div class="control-group">
                        <label class="control-label" for="select01">
                            Search By PIN / Mobile No
                        </label>
                        <div class="controls">
                            @Html.TextBoxFor(model => model.SearchText, new { @class = "span12" })
                        </div>
                    </div>
                </fieldset>
            </div>
            <div class="span4 utopia-form-freeSpace">
                <fieldset>
                    <div class="control-group">
                        @for (int i = 0; i < Model.StatusList.Count(); i++)
                        {
                            @Html.CheckBoxFor(model => model.StatusList[i].Selected, new { @style = "margin-left:20px; margin-right:5px;", @class = "statusChk" })
                            @Html.DisplayFor(model => model.StatusList[i].Text)
                            @Html.HiddenFor(model => model.StatusList[i].Value)
                            @Html.HiddenFor(model => model.StatusList[i].Text)

                        }
                        <input type="hidden" id="StatusIds" value="" />
                        <input style="margin-left:20px; margin-right:5px;" id="StatusList_99__Selected" name="StatusList_99__Selected" class="statusChk" type="checkbox" checked="checked" /> <span style="color:#4800ff">Only Staff</span>
                        <input id="StatusList_99__Value" name="StatusList[99].Value" type="hidden" value="-1">

                    </div>

                </fieldset>
            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="utopia-widget-content">
            <div class="span8 utopia-form-freeSpace">
                <fieldset>
                    <div class="control-group ">
                        Date by: <input type="radio" name="rdoDateType" value="A" checked="checked"> All Data
                        <input type="radio" name="rdoDateType" value="L"> Last Follow-Up
                        <input type="radio" name="rdoDateType" value="N"> Next Folloe-Up
                        <input type="radio" name="rdoDateType" value="E"> Enrollment
                        <input type="hidden" id="dateType" value="A" />
                        <div id="dateDiv">
                            From Date:   @Html.TextBoxFor(model => model.FromDate, "{0:dd MMM, yyyy}", new { @class = "input-small", @placeholder = "Date" })
                            To Date: @Html.TextBoxFor(model => model.ToDate, "{0:dd MMM, yyyy}", new { @class = "input-small", @placeholder = "Date" })
                        </div>
                    </div>
                </fieldset>
            </div>
            <div class="span4 utopia-form-freeSpace">
                <fieldset>
                    <div class="control-group">
                        <div class="controls">
                            <a id="dateSearchButton" class="btn btn-info"><i class="icon icon-search icon-white"></i> Search </a>

                            <a id="prn" href="#" class="btn pull-right"><i class="icon icon-print"></i> Print</a>
                            <a id="exp" href="#" class="btn pull-right"><i class="icon icon-download"></i> Export</a>

                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
</section>

<table id="gridTable" class="table table-striped table-bordered fixed_headers">
    <thead>
        <tr>
            <th>
                Who is
            </th>
            <th>
                PIN
            </th>
            <th>
                Name
            </th>
            <th>
                B/G
            </th>
            <th>
                Designation
            </th>
            <th>
                Program/Project
            </th>
            <th>
                Distrrict
            </th>
            <th>
                Area
            </th>
            <th>
                Hospital/Isolation
            </th>
            <th>
                Alternate Contact
            </th>
            <th>
                Next Followup
            </th>
            <th>
                Counseling by
            </th>
            <th>
                Last Counseling at
            </th>
            @if (UserRole.Check("DoctorPool_Doc", SessionHelper.Role)
                || UserRole.Check("DoctorPool_Suspect", SessionHelper.Role)
                || UserRole.Check("DoctorPool_Council", SessionHelper.Role))
            {
                <th></th>
            }
        </tr>
    </thead>
</table>

@section scripts{
    <script type="text/javascript">
    $(document).ready(function () {

        $('#dateDiv').hide();

        $('input[type=radio][name=rdoDateType]').change(function () {
            if (this.value == 'A') {
                $('#dateDiv').hide();
            }
            else {
                $('#dateDiv').show();
            }
        });

        $("#prn").click(function () {
            $("#gridTable").printThis();
        });

        $("#exp").click(function () {
            tableToExcel('gridTable', 'Export Name');
        });

        DatePicker('FromDate', 'dd MMM, yyyy');
        DatePicker('ToDate', 'dd MMM, yyyy');

        $(".ddl").change(function () {
            GetStatus();
            $('#gridTable').dataTable().fnDraw();
        });

        $("#dateSearchButton").click(function () {
            GetStatus();
            $('#gridTable').dataTable().fnDraw();
        });

        function GetStatus() {
            var stid = '';
            $('.statusChk:checkbox:checked').each(function () {
                var res = '#' + this.id.replace("Selected", "Value");
                stid = stid + $(res).val() + ',';
            });
            $("#StatusIds").val(stid);
        }

        $("#dateSearchButton2").click(function () {
            //$("#onlyPatient").val(true);
            $('#gridTable').dataTable().fnDraw();
        });

        $('#ContentTypeId2').change(function (event) {
            LoadUpazialSearch($('#ContentTypeId2').val());
        });

        @*$('#ContentTypeId2').change(function (event) {
            LoadPointSearch($('#ContentTypeId2').val());
        });*@

        window.LoadUpazialSearch = function (areaId) {
            var url = '@Url.Content("~/Main/GetDistrictByDivision")?id=' + areaId;
            LoadDropDownListWithCall('ContentTypeId3'
                , url
                , 'All District'
                , null);
        }

        @*window.LoadPointSearch = function (locationId) {
            var url = '@Url.Content("~/Point/GetPointsByLocation")?id=' + locationId;
            LoadDropDownListWithCall('ContentTypeId3'
                , url
                , null
                , null);
        }*@

        $('input[type=radio][name=rdoDateType]').change(function () {
            $("#dateType").val(this.value);
        });


        var addPost = {
            'ContentTypeId1': 'ContentTypeId1',
            'ContentTypeId2': 'ContentTypeId2',
            'ContentTypeId3': 'ContentTypeId3',
            'FromDate': 'FromDate',
            'ToDate': 'ToDate',
            'SearchText': 'SearchText',
            'dateType': 'dateType',
            'StatusIds': 'StatusIds'
        }
        var btns = {
            13: false //column number : is button group
        };

        /*data grid initializer*/
        DataTableBinder($("#gridTable")   //table object
            , '@Url.Content("~/DoctorPole/ReportDataGrid")'  //json data url
            , [50, 100, 200, 1000] //record size
            , true //show all with row size
        , addPost  //additional parameters at query string
        , btns   //buttons are at these columns
        , true
        );

    });
    </script>
}
